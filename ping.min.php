<?php function a($a){$b="";for($i=0;$i<5;$i++){$c=$a&127;$a>>=7;if($a>0)$c|=128;$b.=chr($c);if($a==0)break;}return$b;}function b($a){$b=0;$c=0;$d=0;while($b<strlen($a)){$e=ord($a[$b++]);$c|=($e&127)<<$d;if(($e&128)==0)return$c;$d+=7;if($d>=32)return false;}return false;}function c($a,$b,$c){$d=socket_create(AF_INET,SOCK_STREAM,SOL_TCP)or die("无法创建套接字");$e=SOL_SOCKET;$f=["sec"=>2,"usec"=>0];socket_set_option($d,$e,SO_RCVTIMEO,$f);socket_set_option($d,$e,SO_SNDTIMEO,$f);socket_connect($d,$a,$b)or die("无法连接服务器");socket_set_nonblock($d);socket_write($d,$c);$g="";$h=time();while(time()<=$h+2){$i=socket_read($d,8192,PHP_BINARY_READ);if(!empty($i))$g.=$i;}return$g;}function d(&$a){$a=substr($a,strpos($a,"\x00")+1);}function e($a){return isset($_GET[$a])?$_GET[$a]:(isset($_POST[$a])?$_POST[$a]:"");}$a=e("address");$b=e("port");$c=e("ver");$d=e("type");if($c=="java"){$e=a(0).a(340).a(strlen($a)).$a.pack("n",$b).a(1);$e=a(strlen($e)).$e;$e=c($a,$b,$e.a(1).a(0));if(empty($e)){sleep(2);$e=c($a,$b,base64_decode("/gH6"));if($d=="raw")die($e);$e=hex2bin(preg_replace("/([A-Fa-f0-9]{2})00/","$1",bin2hex($e)));$e=substr($e,strpos($e,base64_decode("pzEA"))+3);if($d=="decode")die($e);$f=substr($e,0,strpos($e,"\x00"));d($e);$g=substr($e,0,strpos($e,"\x00"));d($e);$h=substr($e,0,strpos($e,"\x00"));d($e);$i=substr($e,0,strpos($e,"\x00"));$j=substr($e,strpos($e,"\x00")+1);if($d=="text")die("服务端版本: {$g}\n协议版本: {$f}\nMOTD: {$h}\n最大玩家数量: {$j}\n在线玩家数量: {$i}");exit;}if($d=="raw")die($e);$e=substr($e,strlen(a(b(substr($e,0,5))))+2);$e=substr($e,strpos($e, '{"'));if($d=="decode")die($e);if($d=="text"){$f=json_decode($e, true);die("服务端版本: {$f["version"]["name"]}\n协议版本: {$f["version"]["protocol"]}\nMOTD: {$f["description"]}\n最大玩家数量: {$f["players"]["max"]}\n在线玩家数量: {$f["players"]["online"]}");}}elseif($c == "bedrock"){$e=pack("cQ",1,time()).base64_decode("AP//AP7+/v79/f39EjRWeA==").pack("Q",2);$f=socket_create(AF_INET,SOCK_DGRAM,SOL_UDP)or die("无法创建套接字");$g=["sec"=>2,"usec"=>0];$h=SOL_SOCKET;socket_set_option($f,$h,SO_RCVTIMEO,$g);socket_set_option($f,$h,SO_SNDTIMEO,$g);socket_sendto($f,$e,strlen($e),0,$a,$b)or die("无法发送数据");socket_recvfrom($f,$e,1024,0,$a,$b)or die("无法读取数据");socket_close($f);if($d=="raw")die($e);$e=explode(";",substr($e,strpos($e,"MCPE;")+5));if($d=="decode")die(json_encode($e));if($d=="text")die("服务端版本: {$e[2]}\n协议版本: {$e[1]}\nMOTD: {$e[0]}\n最大玩家数量: {$e[4]}\n在线玩家数量: {$e[3]}");}