<?php function a($a){$b="";for($i=0;$i<5;$i++){$c=$a&0x7F;$a>>=7;if($a>0)$c|=0x80;$b.=chr($c);if($a==0)break;}return$b;}function b($a){$b=0;$c=0;$d=0;while($b<strlen($a)){$e=ord($a[$b++]);$c|=($e&0x7F)<<$d;if(($e&0x80)==0)return$c;$d+=7;if($d>=32)return false;}return false;}$a=$_GET["address"];$b=$_GET["port"];$c=$_GET["ver"];$d=$_GET["type"];if($c=="java"){$h=a(0x00).a(340).a(strlen($a)).$a.pack("n",$b).a(1);$h=a(strlen($h)).$h;$i=a(0x00);$i=a(strlen($i)).$i;$j=socket_create(AF_INET,SOCK_STREAM,SOL_TCP)or die("无法创建套接字");socket_set_option($j,$e,$g,["sec"=>2,"usec"=>0]);socket_set_option($j,$e,$f,["sec"=>2,"usec"=>0]);socket_connect($j,$a,$b)or die("无法连接服务器");socket_set_nonblock($j);socket_write($j,$h);socket_write($j,$i);$k="";$l=time();while(time()<$l+2){$m=socket_read($j,8192,PHP_BINARY_READ);if(!empty($m))$k.=$m;}if($d=="raw")die($k);$n=strlen(a(b(substr($k,0,5))));$k=substr($k,0+$n+1+1);$k=substr($k,strpos($k,'{"'));if($d=="decode")die($k);if($d=="text"){$o=json_decode($k,true);die("服务端版本: {$o["version"]["name"]}\n协议版本: {$o["version"]["protocol"]}\nMOTD: {$o["description"]}\n最大玩家数量: {$o["players"]["max"]}\n在线玩家数量: {$o["players"]["online"]}");}}elseif($c=="bedrock"){$h=pack("cQ",0x01,time()).base64_decode("AP//AP7+/v79/f39EjRWeA==").pack("Q",2);$i=socket_create(AF_INET,SOCK_DGRAM,SOL_UDP)or die("无法创建套接字");socket_set_option($i,$e,$g,["sec"=>2,"usec"=>0]);socket_set_option($i,$e,$f,["sec"=>2,"usec"=>0]);socket_sendto($i,$h,strlen($h),0,$a,$b);socket_recvfrom($i,$h,1024,0,$a,$b);socket_close($i);if($d=="raw")die($h);$h=explode(";",substr($h,strpos($h,"MCPE;")+5));if($d=="decode")die(json_encode($h));if($d=="text")die("服务端版本: {$h[2]}\n协议版本: {$h[1]}\nMOTD: {$h[0]}\n最大玩家数量: {$h[4]}\n在线玩家数量: {$h[3]}");}